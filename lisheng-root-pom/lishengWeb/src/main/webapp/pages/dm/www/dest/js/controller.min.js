var app=angular.module("myapp",["ui.router"]);window.location.host.indexOf("localhost")>=0||window.location.host.indexOf("10.228.18.230")>=0?api="http://10.100.100.204:8280/doorManagement":api="http://"+window.location.host+"/doorManagement",app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/compartment"),t.state("compartment",{url:"/compartment",templateUrl:"template/compartment/index.html",controller:"compartmentCtrl"}).state("compartment/createDoor",{url:"/compartment/createDoor",templateUrl:"template/createdoor/index.html",controller:"createdoorCtrl"}).state("compartment/logs",{url:"/compartment/logs?id",templateUrl:"template/compartment/logs.html",controller:"openLogCtrl"}).state("/compartment/operateLog",{url:"/compartment/operateLog?id",templateUrl:"template/compartment/operateLog.html",controller:"operateLogCtrl"}).state("setType",{url:"/setType",templateUrl:"template/setType/index.html",controller:"setTypeCtrl"}).state("/setType/editType",{url:"/setType/editType",templateUrl:"template/setType/editType.html",controller:"setTypeCtrl"}).state("employeeAuthority",{url:"/employeeAuthority",templateUrl:"template/employeeAuthority/index.html",controller:"employeeAuthorityCtrl"}).state("employeeAuthority/details",{url:"/employeeAuthority/details?userId?enterPriseId?employeeId",templateUrl:"template/employeeAuthority/details.html",controller:"employeeDetailCtrl"}).state("employeeAuthority/details/editAuth",{url:"/employeeAuthority/details/editAuth?id?enterPriseId",templateUrl:"template/employeeAuthority/edit.html",controller:"editCtrl"}).state("employeeAuthority/details/logs",{url:"/employeeAuthority/details/logs?id",templateUrl:"template/employeeAuthority/logs.html",controller:"logCtrl"}).state("clientAuthority",{url:"/clientAuthority",templateUrl:"template/clientAuthority/index.html",controller:"clientAuthorityCtrl"}).state("clientAuthority/details",{url:"/clientAuthority/details?",templateUrl:"template/clientAuthority/details.html",controller:"clientDetailCtrl"})}]),app.filter("format",function(){return function(t){return t.join(",")}}),app.run(["$rootScope","$state","$stateParams",function(t,e,o){t.$state=e,t.$stateParams=o,t.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0})}]),app.filter("proNoMatch",function(){return function(t,e){if(t)for(var o=0;o<t.length;o++)console.log(t[o].boardRoomNO),console.log(typeof t[o].boardRoomNO),t[o].boardRoomNO.match(e)}});
app.service("getMenu",["$http","$rootScope","$location",function(t,e,o){e.searchHide=!1,this.real=function(t){e.showMenu=!0,t||swal({title:"菜单加载失败",text:"请重新登录",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!0}),"1"==t&&(e.menus=[{id:0,menuName:"门禁",childrenMenuList:[{menuId:0,menuName:"门禁列表",url:"#/compartment"},{menuId:1,menuName:"类型设置",url:"#/setType"}]},{id:2,menuName:"权限分配",childrenMenuList:[{menuId:0,menuName:"按方糖员工",url:"#/employeeAuthority"},{menuId:1,menuName:"按入驻成员",url:"#/clientAuthority"}]}]);var n="#"+o.url();angular.forEach(e.menus,function(t){angular.forEach(t.childrenMenuList,function(t){t.url==n&&(t.isActive=!0,console.log(t.isActive))})})}}]),app.service("pin",["$timeout",function(t){this.real=function(){$(window).scroll(function(){var t=$("body").scrollTop(),e=$(".list-box").length;if(0!=e){var o=$(".list-box").offset().top;t>o?$(".pin-title").addClass("table-fixed"):$(".pin-title").removeClass("table-fixed")}})}}]),app.service("liveorder",["$http","$rootScope",function(t,e){this.real=function(o,n){e.orderlist=n,t({url:api+"/order/queryMokaNeedLogistics",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({orderId:o})}).then(function(t){e.liveorder=t.data[0],console.log(e.orderlist);for(var n=0;n<e.orderlist.length;n++)e.orderlist[n].orderId==o&&(e.orderlist[n]=e.liveorder)})}}]),app.service("loading",["$rootScope","$timeout",function(t,e){this.show=function(){t.showLoading=!0},this.hide=function(){e(function(){t.showLoading=!1},300)}}]),app.service("datepicker",["$timeout",function(t){this.real=function(){t(function(){$(".datepicker").datetimepicker({format:"yyyy-mm-dd",startView:"year",minView:"month"})},50),$.fn.datetimepicker.dates.en={days:["日","一","二","三","四","五","六","日"],daysShort:["日","一","二","三","四","五","六","日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],meridiem:["上午","下午"],suffix:["st","nd","rd","th"],today:"今天"}}}]),app.service("getTown",["$http","$rootScope",function(t,e){this.getCitys=function(){t({url:api+"/remote/getCityList",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({})}).then(function(t){"1"==t.data.ret?(e.citys=t.data.data,e.communitys=[]):(this.getCommunitys(),swal({title:t.data.mess,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}))})},this.getCommunitys=function(o){t({url:api+"/remote/getCommunityByCity",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({cityId:o})}).then(function(t){"1"==t.data.ret?e.communitys=t.data.data:(e.communitys=[],swal({title:t.data.mess,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}))})}}]),app.service("setType",["$http","$rootScope",function(t,e){this.getDoorTypes=function(o){t({url:api+"/childdoortype/queryChildDoorTypes",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({pageNum:o,pageSize:20})}).then(function(t){e.doorTypeInfo=t.data.data;var o=t.data.count/20,n=/^[0-9]*[1-9][0-9]*$/;o=n.test(o)?parseInt(o):parseInt(o)+1;for(var i=[],r=o-1;r>=0;r--)i.push(r);$scope.pageSkip=i,$scope.maxPageSkip=o})}}]);
app.controller("clientAuthorityCtrl",["$scope","$rootScope","$http","getMenu","pin","loading",function(t,e,o,a,r,n){a.real(1),t.getlist=function(e,a){t.skip=e,a?t.sdata=a:t.sdata=[],console.log(t.sdata),n.show(),o({url:api+"/doorauth/queryUsersDoorAuth",method:"POST",data:$.param({pageNum:e,pageSize:20,type:2,enterPriseName:t.sdata.teamName,userName:t.sdata.employeeName,phoneNO:t.sdata.phoneNum}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){t.clients=e.data.data;var o=e.data.count/20,a=/^[0-9]*[1-9][0-9]*$/;o=a.test(o)?parseInt(o):parseInt(o)+1;for(var i=[],d=o-1;d>=0;d--)i.push(d);t.pageSkip=i,t.maxPageSkip=o,r.real(),n.hide()})},t.getlist("1")}]),app.controller("clientDetailCtrl",["$scope","$rootScope","$http","getMenu","pin","datepicker","$location","$filter",function(t,e,o,a,r,n,i,d){a.real(1),n.real(),t.userId=i.search().id,t.priseId=i.search().priseId,t.employeeId=i.search().employeeId,t.getInfo=function(){o({url:api+"/doorauth/queryUsersDoorAuth",method:"POST",data:$.param({employeeId:t.employeeId,type:2}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?t.infos=e.data.data:swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.getInfo(),t.getDetails=function(){o({url:api+"/doorauth/queryDoorAuthDetailsByUserId",method:"POST",data:$.param({userId:t.userId,enterPriseId:t.priseId}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?t.details=e.data.data:swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.getDetails(),t.delete=function(e){t.id=e,$("#delete").modal("show")},t.saveDelete=function(){o({url:api+"/doorauth/cancleDoorAuthByAuthId",method:"POST",data:$.param({doorAuthId:t.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?($("#delete").modal("hide"),t.live(t.id),swal({title:"权限已删除",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.delay=function(e){t.changeId=e,$("#delay").modal("show")},t.saveDelay=function(){o({url:api+"/doorauth/updateAuthTimeByFiveDays",method:"POST",data:$.param({doorAuthId:t.changeId}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){1==e.data.ret?($("#delay").modal("hide"),t.live(t.changeId),swal({title:"延五天成功",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.change=function(e,o,a){t.changeId=e,$("#change").modal("show")},t.saveChange=function(){return t.sdata.startTime?t.sdata.endTime?t.sdata.startTime>t.sdata.endTime?void swal({title:"截止时间必须大于起始时间",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void o({url:api+"/doorauth/updateDoorAuthTimeByAuthId",method:"POST",data:$.param({doorAuthId:t.changeId,startTime:t.sdata.startTime,endTime:t.sdata.endTime,remark:t.remark}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){1==e.data.ret?($("#change").modal("hide"),t.live(t.changeId),swal({title:"有效时间已修改",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})}):void swal({title:"结束时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"起始时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})},t.filter2=function(t){return null!==t||void 0},t.live=function(e){o({url:api+"/doorauth/queryDoorAuthDetailsByUserId",method:"POST",data:$.param({doorAuthId:e}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(o){t.data=o.data.data,angular.forEach(t.data,function(e){angular.forEach(e,function(e){t.data=e})}),angular.forEach(t.details,function(o,a){angular.forEach(o,function(o,r){o.doorAuthId==e&&(t.details[a][r]=t.data)})})})}}]);
app.controller("compartmentCtrl",["$scope","$http","getMenu","getTown","datepicker","loading","pin","$location",function(o,t,a,e,d,r,n,s){d.real(),a.real(1),e.getCitys(),o.getCommunitys=function(o){e.getCommunitys(o)},window.location.host.indexOf("localhost")>=0||window.location.host.indexOf("10.228.18.230")>=0?o.download="http://10.100.100.204:8280/doorManagement":o.download="http://"+window.location.host+"/doorManagement",o.getlist=function(a,e){o.skip=a,e?o.sdata=e:o.sdata=[],console.log(o.sdata),r.show(),t({url:api+"/door/queryDoorInfoList",method:"POST",data:$.param({pageNum:a,pageSize:20,doorTypeId:o.sdata.doorTypeId,startTime:o.sdata.startTime,endTime:o.sdata.endTime,ip_address:o.sdata.IP_address,communityId:o.sdata.communityId,status:o.sdata.status,childDoorTypeId:o.sdata.childDoorTypeId,roomType:o.sdata.roomType,productNO:o.sdata.roomId,doorIndentity:o.sdata.doorIndentity}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){o.doorList=t.data.data;var a=t.data.count/20,e=/^[0-9]*[1-9][0-9]*$/;a=e.test(a)?parseInt(a):parseInt(a)+1;for(var d=[],s=a-1;s>=0;s--)d.push(s);o.pageSkip=d,o.maxPageSkip=a,n.real(),r.hide()})},o.getlist("1"),o.exportSheet=function(t){t?o.sdata=t:o.sdata=[],o.sdata.communityId||(o.sdata.communityId=""),o.sdata.doorTypeId||(o.sdata.doorTypeId=""),o.sdata.startTime||(o.sdata.startTime=""),o.sdata.endTime||(o.sdata.endTime=""),o.sdata.IP_address||(o.sdata.IP_address=""),o.sdata.status||(o.sdata.status=""),o.sdata.childDoorTypeId||(o.sdata.childDoorTypeId=""),o.sdata.roomType||(o.sdata.roomType=""),o.sdata.roomId||(o.sdata.roomId=""),o.sdata.doorIndentity||(o.sdata.doorIndentity=""),console.log(api+"/door/exportDoorList?communityId="+o.sdata.communityId+"&doorTypeId="+o.sdata.doorTypeId+"&startTime="+o.sdata.startTime+"&endTime="+o.sdata.endTime+"&ip_address="+o.sdata.IP_address+"&status="+o.sdata.status+"&childDoorTypeId="+o.sdata.childDoorTypeId+"&roomType="+o.sdata.roomType+"&roomId="+o.sdata.roomId+"&doorIndentity="+o.sdata.doorIndentity),window.open(api+"/door/exportDoorList?communityId="+o.sdata.communityId+"&doorTypeId="+o.sdata.doorTypeId+"&startTime="+o.sdata.startTime+"&endTime="+o.sdata.endTime+"&ip_address="+o.sdata.IP_address+"&status="+o.sdata.status+"&childDoorTypeId="+o.sdata.childDoorTypeId+"&roomType="+o.sdata.roomType+"&roomId="+o.sdata.roomId+"&doorIndentity="+o.sdata.doorIndentity)},o.getChild=function(a){o.children=[],o.sdata.childDoorTypeId="",o.sdata.doorTypeId&&t({url:api+"/childdoortype/queryChildDoorTypeByDoorTypeId",method:"POST",data:$.param({doorTypeId:a}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){1===t.data.ret?o.children=t.data.data:swal({title:t.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},o.cancle=function(t){o.doorId=t,$("#cancleDoor").modal("show")},o.saveCancleDoor=function(){t({url:api+"/door/cancleEntranceGuar",method:"POST",data:$.param({doorId:o.doorId}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){$("#cancleDoor").modal("hide"),1===t.data.ret&&(o.live(o.doorId),swal({title:"门禁已作废",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}))})},o.stopDoor=function(t,a){o.doorId=t,o.stopDoorStatus=a,$("#stopDoor").modal("show")},o.saveStopDoor=function(){t({url:api+"/door/changeEntranceGurdStatus",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({doorId:o.doorId,status:2})}).then(function(t){$("#stopDoor").modal("hide"),o.live(o.doorId),1===t.data.ret&&swal({title:"门禁已停用",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},o.reUseDoor=function(t,a){o.doorId=t,o.reUseDoorStatus=a,$("#reUseDoor").modal("show")},o.saveReUseDoor=function(){t({url:api+"/door/changeEntranceGurdStatus",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({doorId:o.doorId,status:1})}).then(function(t){$("#reUseDoor").modal("hide"),1===t.data.ret?(o.live(o.doorId),swal({title:"门禁已恢复",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})):swal({title:t.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},o.live=function(a){t({url:api+"/door/queryDoorInfoList",method:"POST",data:$.param({doorId:a}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){o.data=t.data.data[0],console.log(o.data);for(var e=0;e<o.doorList.length;e++)o.doorList[e].doorId==a&&(o.doorList[e]=o.data)})}}]),app.controller("openLogCtrl",["$scope","$http","getMenu","getTown","datepicker","loading","pin","$location",function(o,t,a,e,d,r,n,s){d.real(),a.real(1),o.id=s.search().id,o.getInfo=function(){t({url:api+"/door/queryDoorInfoList",method:"POST",data:$.param({doorId:o.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){1==t.data.ret&&(o.doorList=t.data.data)})},o.getInfo(),o.getOpenLog=function(a,e){o.skip=a,e?o.sdata=e:o.sdata=[],r.show(),t({url:api+"/door/queryDoorLogs",method:"POST",data:$.param({pageNum:a,pageSize:20,userName:o.sdata.userName,enterPriseName:o.sdata.enterPriseName,phoneNum:o.sdata.phoneNum,startTime:o.sdata.startTime,endTime:o.sdata.endTime,result:o.sdata.result,doorId:o.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){o.logs=t.data.data;var a=t.data.count/20,e=/^[0-9]*[1-9][0-9]*$/;a=e.test(a)?parseInt(a):parseInt(a)+1;for(var d=[],s=a-1;s>=0;s--)d.push(s);o.pageSkip=d,o.maxPageSkip=a,n.real(),r.hide()})},o.getOpenLog(1)}]),app.controller("operateLogCtrl",["$scope","$http","getMenu","getTown","datepicker","loading","pin","$location",function(o,t,a,e,d,r,n,s){a.real(1),o.id=s.search().id,o.getlist=function(a,e){o.skip=a,e?o.sdata=e:o.sdata=[],console.log(o.sdata),t({url:api+"/door/queryDoorOperateLogs",method:"POST",data:$.param({pageNum:a,pageSize:20,doorId:o.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){o.operateLogs=t.data.data;var a=t.data.count/20,e=/^[0-9]*[1-9][0-9]*$/;a=e.test(a)?parseInt(a):parseInt(a)+1;for(var d=[],r=a-1;r>=0;r--)d.push(r);o.pageSkip=d,o.maxPageSkip=a,n.real()})},o.getlist("1")}]);
app.controller("createdoorCtrl",["$scope","$http","$rootScope","getMenu","setType","getTown","$state","$timeout",function(o,t,e,n,r,a,d,i){n.real(1),e.showMenu=!0,o.showMenu=!0,a.getCitys(),o.getCommunitys=function(o){a.getCommunitys(o)},o.childDoor=[],o.getChildDoor=function(e,n){o.index=n,console.log(o.index),t({url:api+"/childdoortype/queryChildDoorTypeByDoorTypeId",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({doorTypeId:e})}).then(function(t){o.childDoor[o.index]=t.data.data,console.log(o.childDoor)})},o.compartment=[],o.meetingRoom=[],o.getCompartment=function(e){3==e?t({url:api+"/remote/getStationTypeByCommunity",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({communityId:o.sdata.communityId,type:2})}).then(function(t){o.compartment[o.index]=t.data.data,console.log(o.compartment)}):4==e&&t({url:api+"/remote/queryMeetingRoomListBycommunityId",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({communityId:o.sdata.communityId})}).then(function(t){o.meetingRoom[o.index]=t.data.data})},o.rooms=[],o.getRoom=function(e){t({url:api+"/remote/getStationByType",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({stationTypeId:e})}).then(function(t){o.rooms[o.index]=t.data.data})},angular.forEach(o.meetingRoom,function(t){t.boardRoomTypeId==o.sdata.boardRoomTypeId&&(o.sdata.boardRoomId=t.boardRoomId)}),o.save=function(){return angular.forEach(e.communitys,function(t){t.communityId==o.sdata.communityId&&(o.sdata.communityName=t.communityName)}),angular.forEach(o.data,function(t){t.communityName=o.sdata.communityName,t.communityId=o.sdata.communityId,t.doorName=""}),console.log(o.data),console.log(o.sdata),o.sdata?o.cityId?o.sdata.communityId?void angular.forEach(o.data,function(e,n){return e.IP_address?e.doorIndentity?e.doorTypeId?e.childDoorTypeId?e.roomId||2!=e.doorTypeId?(1!=e.doorTypeId||e.stationTypeId||e.boardRoomTypeId||(e.roomType=3),2==e.doorTypeId&&3==e.childDoorTypeId&&(e.roomType=1),2==e.doorTypeId&&4==e.childDoorTypeId&&(e.roomType=2),void(n==o.data.length-1&&t({url:api+"/door/addDoorInfo",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({data:angular.toJson(o.data)})}).then(function(o){1==o.data.ret&&(swal({title:"创建成功",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600}),i(function(){d.go("compartment")},1600))}))):void swal({title:"请选择包间编号或会议室编号",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请选择门禁子类型",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请选择门禁类型",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请输入设备编号",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请输入IP地址",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})}):void swal({title:"请选择社区",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请选择城市",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"参数错误",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})},o.data=[{}],o.add=function(){o.data.push({})},o.del=function(t){o.data.splice(t,1)}}]);
app.controller("employeeAuthorityCtrl",["$scope","$rootScope","$http","getMenu","pin","loading","$location","$filter",function(t,e,o,a,r,n,i,d){a.real(1),t.getlist=function(e,a){t.skip=e,a?t.sdata=a:t.sdata=[],console.log(t.sdata),n.show(),o({url:api+"/doorauth/queryUsersDoorAuth",method:"POST",data:$.param({pageNum:e,pageSize:20,type:1,userName:t.sdata.employeeName,phoneNO:t.sdata.phoneNum,email:t.sdata.eMailAddress}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){t.employees=e.data.data;var o=e.data.count/20,a=/^[0-9]*[1-9][0-9]*$/;o=a.test(o)?parseInt(o):parseInt(o)+1;for(var i=[],d=o-1;d>=0;d--)i.push(d);t.pageSkip=i,t.maxPageSkip=o,r.real(),n.hide()})},t.getlist("1")}]),app.controller("employeeDetailCtrl",["$scope","$rootScope","$http","getMenu","pin","$location","datepicker","$filter",function(t,e,o,a,r,n,i,d){a.real(1),i.real(),t.userId=n.search().id,t.priseId=n.search().priseId,t.employeeId=n.search().employeeId,t.sdata||(t.sdata=[]),t.getInfo=function(){o({url:api+"/doorauth/queryUsersDoorAuth",method:"POST",data:$.param({employeeId:t.employeeId,type:1}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?t.infos=e.data.data:swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.getInfo(),t.getDetails=function(){o({url:api+"/doorauth/queryDoorAuthDetailsByUserId",method:"POST",data:$.param({userId:t.userId,enterPriseId:t.priseId}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?t.details=e.data.data:swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.getDetails(),t.delete=function(e){t.id=e,$("#delete").modal("show")},t.saveDelete=function(){o({url:api+"/doorauth/cancleDoorAuthByAuthId",method:"POST",data:$.param({doorAuthId:t.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){1==e.data.ret?($("#delete").modal("hide"),t.live(t.id),swal({title:"权限已删除",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.change=function(e,o,a){t.changeId=e,t.sdata.startTime=d("date")(o,"yyyy-MM-dd"),t.sdata.endTime=d("date")(a,"yyyy-MM-dd"),$("#change").modal("show")},t.saveChange=function(){return t.sdata.startTime?t.sdata.endTime?t.sdata.startTime>t.sdata.endTime?void swal({title:"截止时间必须大于起始时间",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void o({url:api+"/doorauth/updateDoorAuthTimeByAuthId",method:"POST",data:$.param({doorAuthId:t.changeId,startTime:t.sdata.startTime,endTime:t.sdata.endTime,remark:t.remark}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){1==e.data.ret?($("#change").modal("hide"),t.live(t.changeId),swal({title:"有效时间已修改",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:e.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})}):void swal({title:"结束时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"起始时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})},t.filter2=function(t){return null!==t||void 0},t.live=function(e){o({url:api+"/doorauth/queryDoorAuthDetailsByUserId",method:"POST",data:$.param({doorAuthId:e}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(o){t.data=o.data.data,angular.forEach(t.data,function(e){angular.forEach(e,function(e){t.data=e})}),angular.forEach(t.details,function(o,a){angular.forEach(o,function(o,r){o.doorAuthId==e&&(t.details[a][r]=t.data)})})})}}]),app.controller("editCtrl",["$scope","$rootScope","$http","getMenu","pin","$location","datepicker","getTown","$state",function(t,e,o,a,r,n,i,d,s){a.real(1),i.real(),d.getCitys(),t.getCommunitys=function(t){d.getCommunitys(t)},t.userId=n.search().id,t.enterPriseId=n.search().enterPriseId,t.getDoor=function(e){o({url:api+"/doorauth/queryDoorNotInUserAuth",method:"POST",data:$.param({communityId:t.communityId,userId:t.userId}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){1==e.data.ret?(t.unOwns=e.data.data,i.real()):swal({title:"在当前社区无拥有门禁权限",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.selectAll=function(){$("[data-all]").hasClass("actived")&&angular.forEach(t.unOwns,function(t){t.isChecked=!0}),$("[data-common]").hasClass("actived")&&angular.forEach(t.unOwns,function(t){1==t.doorTypeId?t.isChecked=!0:t.isChecked=!1}),$("[data-private]").hasClass("actived")&&angular.forEach(t.unOwns,function(t){2==t.doorTypeId?t.isChecked=!0:t.isChecked=!1})},t.notSelect=function(){angular.forEach(t.unOwns,function(t){t.isChecked=!1})},t.allS=!0,t.all=function(){t.allS=!0,t.commonS=!1,t.privateS=!1},t.common=function(){t.commonS=!0,t.privateS=!1,t.allS=!1},t.private=function(){t.privateS=!0,t.commonS=!1,t.allS=!1},$(".filter>a").on("click",function(){$(this).addClass("actived").siblings().removeClass("actived")}),t.setTime=function(){angular.forEach(t.unOwns,function(e){1==e.isChecked&&(e.startTime=t.sdata.setStartTime,e.endTime=t.sdata.setEndTime)})},t.create=function(){return t.saveAuthList=[],t.cityId?t.communityId?(angular.forEach(t.unOwns,function(e){1==e.isChecked&&(t.saveObj={communityId:e.communityId,doorId:e.doorId,endTime:e.endTime,enterPriseId:t.enterPriseId,roomId:e.roomId,startTime:e.startTime,userId:t.userId,remark:t.remark},t.saveAuthList.push(t.saveObj))}),console.log(t.saveAuthList),0==t.saveAuthList.length?void swal({title:"请选择门禁",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void angular.forEach(t.saveAuthList,function(e,a){return e.startTime?e.endTime?e.startTime>e.endTime?void swal({title:"截止时间必须大于起始时间",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void(a==t.saveAuthList.length-1&&o({url:api+"/doorauth/saveUserExtraAuth",method:"POST",data:$.param({data:angular.toJson(t.saveAuthList)}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(t){1==t.data.ret?swal({title:"门禁已创建",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600}):swal({title:t.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}),1==t.data.count&&s.go("employeeAuthority"),2==t.data.count&&s.go("clientAuthority")})):void swal({title:"截止时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"起始时间不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})):void swal({title:"请先选择社区",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请先选择城市",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})}}]),app.controller("logCtrl",["$scope","$http","getMenu","getTown","datepicker","loading","pin","$location",function(t,e,o,a,r,n,i,d){o.real(1),t.id=d.search().id,t.getlist=function(o,a){t.skip=o,a?t.sdata=a:t.sdata=[],console.log(t.sdata),n.show(),e({url:api+"/doorauth/queryDoorAuthLogs",method:"POST",data:$.param({pageNum:o,pageSize:20,userId:t.id}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(e){t.operateLogs=e.data.data;var o=e.data.count/20,a=/^[0-9]*[1-9][0-9]*$/;o=a.test(o)?parseInt(o):parseInt(o)+1;for(var r=[],d=o-1;d>=0;d--)r.push(d);t.pageSkip=r,t.maxPageSkip=o,i.real(),n.hide()})},t.getlist("1")}]);
$(function(e){setTimeout(function(){e("#content-wrapper > .row").css({opacity:1})},200),e("#sidebar-nav .dropdown-toggle").on("click",function(n){n.preventDefault();var a=e(this).parent();a.hasClass("open")||(a.parent().find(".open .submenu").slideUp("fast"),a.parent().find(".open").toggleClass("open")),a.toggleClass("open"),a.hasClass("open")?a.children(".submenu").slideDown("fast"):a.children(".submenu").slideUp("fast")}),e("body").on("mouseenter","#page-wrapper.nav-small #sidebar-nav .dropdown-toggle",function(n){e(this).parents("#sidebar-nav");if(e(document).width()>=992){var a=e(this).parent();a.addClass("open"),a.children(".submenu").slideDown("fast")}}),e("body").on("mouseleave","#page-wrapper.nav-small #sidebar-nav > .nav-pills > li",function(n){e(this).parents("#sidebar-nav");if(e(document).width()>=992){var a=e(this);a.hasClass("open")&&(a.find(".open .submenu").slideUp("fast"),a.find(".open").removeClass("open"),a.children(".submenu").slideUp("fast")),a.removeClass("open")}}),e("#make-small-nav").click(function(n){e("#page-wrapper").toggleClass("nav-small")}),e(window).smartresize(function(){e(document).width()<=991&&e("#page-wrapper").removeClass("nav-small")}),e(".mobile-search").click(function(n){n.preventDefault(),e(".mobile-search").addClass("active"),e(".mobile-search form input.form-control").focus()}),e(document).mouseup(function(n){var a=e(".mobile-search");a.is(n.target)||0!==a.has(n.target).length||a.removeClass("active")}),e("[data-toggle='tooltip']").each(function(n,a){e(a).tooltip({placement:e(this).data("placement")||"top"})})}),$.fn.removeClassPrefix=function(e){return this.each(function(n,a){var s=a.className.split(" ").filter(function(n){return 0!==n.lastIndexOf(e,0)});a.className=s.join(" ")}),this},function(e,n){var a=function(e,n,a){var s;return function(){function t(){a||e.apply(i,o),s=null}var i=this,o=arguments;s?clearTimeout(s):a&&e.apply(i,o),s=setTimeout(t,n||100)}};jQuery.fn[n]=function(e){return e?this.bind("resize",a(e)):this.trigger(n)}}(jQuery,"smartresize");
app.controller("setTypeCtrl",["$scope","$http","$rootScope","getMenu","$state","$timeout","pin","loading",function(t,o,e,a,d,r,n,i){a.real(1),t.showMenu=!1,console.log(e),t.getlist=function(e,a){t.skip=e,a?t.sdata=a:t.sdata=[],console.log(t.sdata),i.show(),o({url:api+"/childdoortype/queryChildDoorTypes",method:"POST",data:$.param({pageNum:e,pageSize:20}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8 "}}).then(function(o){t.doorTypeInfo=o.data.data;var e=o.data.count/20,a=/^[0-9]*[1-9][0-9]*$/;e=a.test(e)?parseInt(e):parseInt(e)+1;for(var d=[],r=e-1;r>=0;r--)d.push(r);t.pageSkip=d,t.maxPageSkip=e,n.real(),i.hide()})},t.getlist("1"),t.startUsing=function(o){$("#startUsing").modal("show"),t.status=1,t.Id=o},t.saveStartUsing=function(){o({url:api+"/childdoortype/updateChildDoorTypeStatus",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({childDoorTypeId:t.Id,status:t.status})}).then(function(o){1===o.data.ret?($("#startUsing").modal("hide"),t.live(t.Id),swal({title:o.data.msg,text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:o.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.stopUsing=function(o){$("#stopUsing").modal("show"),t.Id=o,t.status=2},t.saveStopUsing=function(){o({url:api+"/childdoortype/updateChildDoorTypeStatus",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({childDoorTypeId:t.Id,status:t.status})}).then(function(o){1===o.data.ret?($("#stopUsing").modal("hide"),t.live(t.Id),swal({title:o.data.msg,text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:o.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})})},t.editType=function(o,e,a){$("#editType h4").text("编辑类型"),$("#editType").modal("show"),t.childDoorTypeId=o,t.sdata.doorTypeId=angular.toJson(e),t.sdata.childDoorTypeName=a},t.saveEditType=function(){return t.sdata.doorTypeId?t.sdata.childDoorTypeName?void o({url:api+"/childdoortype/saveChildDoorType",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({childDoorTypeId:t.childDoorTypeId,doorTypeId:t.sdata.doorTypeId,childDoorTypeName:t.sdata.childDoorTypeName})}).then(function(o){1==o.data.ret?($("#editType").modal("hide"),t.childDoorTypeId?t.live(t.childDoorTypeId):t.getlist(1),swal({title:"编辑成功",text:"",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1,timer:1600})):swal({title:o.data.msg,text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})}):void swal({title:"门禁子类型名称不能为空",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1}):void swal({title:"请选择门禁类型",text:"",type:"error",confirmButtonColor:"#DD6B55",confirmButtonText:"知道了",closeOnConfirm:!1})},t.createType=function(){t.childDoorTypeId="",$("#editType h4").text("创建类型"),$("#editType").modal("show"),t.sdata.doorTypeId="",t.sdata.childDoorTypeName=""},t.live=function(e){o({url:api+"/childdoortype/queryChildDoorTypes",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({childDoorTypeId:e})}).then(function(o){t.data=o.data.data[0],console.log(t.data);for(var a=0;a<t.doorTypeInfo.length;a++)t.doorTypeInfo[a].childDoorTypeId==e&&(t.doorTypeInfo[a]=t.data)})}}]);